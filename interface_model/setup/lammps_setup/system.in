log npt.log
#==============
# Parameters
#==============

units           metal
timestep 0.001
dimension 3
boundary p p p
atom_style      full
atom_modify     map yes
newton          on
#bond_style      harmonic
#angle_style     harmonic
#dihedral_style  opls 
neigh_modify every 1 delay 0 check no
#kspace_style pppm 1.0e-5

# read in coordinate file
read_data "system_nobonds.data"

pair_style      mace no_domain_decomposition
pair_coeff      * * /home/x-ryu3/LAMMPS_interface/setup/mace-mpa-0-medium.model-lammps.pt O H h3o N O Ti H
pair_modify shift yes mix arithmetic

# import non-bonded (LJ) interaction parameters
#include "system.in.settings"

#==============
# Energy minimization
#==============
group metal type 6 7
fix freeze metal setforce 0.0 0.0 0.0
minimize 1.0e-5 1.0e-7 1000 10000
reset_timestep 0

#==============
# NPT run
#==============

variable t equal step
group mobile subtract all metal
velocity mobile create 298 12345
group gSPCE type  1  2
group cation type 3
group nitrate type 4 5
group WaterNitrate type 1 2 4 5

dump unwrapped all dcd 1000 npt_unwrapped_$t.dcd 
dump_modify unwrapped unwrap yes

dump nptxyz all xyz 1000 npt_traj.xyz
dump_modify nptxyz first yes

# fix water bonds and angles of water and nitrate
# fix fShake WaterNitrate shake 0.0001 100 0 b 1 2 a 1 2
compute mobile_temp mobile temp
fix NPT mobile npt temp 298 298 0.1 z 1.0 1.0 1.00

thermo_style custom time step c_mobile_temp press vol density pe ke etotal ecoul elong evdwl epair
thermo 1000
thermo_modify norm no flush yes

restart 1000 run1.restart run2.restart
write_dump all xyz initial_structure.xyz 
run   10000
write_dump all xyz final_npt_structure.xyz 
write_data end_npt.data